jQuery(function(e){var t={$addDiv:e("div#cp-add-container"),$header:e("h2#section-header"),$ajaxLoader:e("img#ajax-loader").hide(),$submit:e("input.cp-submit"),$deleteDiv:e("div#delete-container"),regExURL:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,regExDate:/\d{4}-\d{2}-\d{2}/,loadingGif:'<img src="'+phpvars.plugin_url+'img/ajax-loader.gif" class="loading-gif" alt="loadingâ€¦">',addedFlag:false,editID:0,eventProgVenue:e("div.cp-inside").attr("data-page"),deleteVals:{},numResultsPerPage:+phpvars.numResultsPerPage,eventsToDelete:"",popped:"state"in window.history,initialURL:location.href,pageNo:1,event:{$date:e("input#concert-date"),$endDate:e("input#concert-end-date"),$multiDate:e("input#multi-date"),$hour:e("select#concert-hour"),$min:e("select#concert-min"),$venueSelect:e("select#select-venue"),$progSelect:e("select#select-prog"),$showVenue:e("a#show-venue"),$venueHide:e(".venue-hide"),$showProg:e("a#show-prog"),$progHide:e(".prog-hide")},prog:{$progTitle:e("input#programme-title")},venue:{$venueName:e("input#venue-name"),$venueURL:e("input#venue-url"),$venueAddress:e("input#venue-address")},stripslashes:function(e){e=e.replace(/\\'/g,"'");e=e.replace(/\\"/g,'"');e=e.replace(/\\0/g,"\0");e=e.replace(/\\\\/g,"\\");return e},hideStuff:function(){if(adminpage==="concertpress_page_events"){e(".venue-hide, .prog-hide").hide()}e("#map-canvas").hide()}(),removeMessageDivs:function(){if(e("div.message").length){e("div.message").remove()}},scrollUp:function(){e("body, html").animate({scrollTop:0},500)},showAddEditDiv:function(t){var n=this,r={scroll:true},t=e.extend(r,t);if(!this.$addDiv.is(":visible")){this.$addDiv.fadeIn(500,function(){if(t.scroll===true){n.scrollUp()}})}else{if(t.scroll===true){n.scrollUp()}}},hideAddEditDiv:function(t){var n=this,r={scroll:true,removeMessages:true},t=e.extend(r,t);e("input.cp-clear").val("");if(adminpage==="concertpress_page_events"){n.event.$venueHide.add(n.event.$progHide).hide();if(n.event.$multiDate.is(":checked")){n.event.$multiDate.attr("checked",false).trigger("change")}n.event.$hour.add(n.event.$min).attr("disabled",false).val(0)}n.event.$showVenue.add(n.event.$showProg).show();if(adminpage==="concertpress_page_events"||adminpage==="concertpress_page_programmes"){tinyMCE.init({height:"300",onitit:function(){tinyMCE.activeEditor.setContent("")}})}n.$addDiv.slideUp(500);if(t.scroll===true){n.scrollUp()}if(t.removeMessages===true){n.removeMessageDivs()}},messageFeedback:function(t){var n=this,r={message:"",type:"updated",callback:""},t=e.extend(r,t),i='<div class="message '+t.type+'">'+t.message+"</div>";n.removeMessageDivs();n.$header.after(i);e(".message").hide().fadeIn(400,function(){n.scrollUp();if(typeof t.callback=="function"){t.callback.call(n)}})},$dialog:e("div#delete-container").dialog({autoOpen:false,modal:true,width:550,resizable:false,buttons:{cancel:function(){e(this).dialog("close");e("select#action").val(0)},"delete":function(){e(this).dialog("close");t.deleteEventProgOrVenue()}},show:"drop"}),reloadAfterAjax:function(t){var n=this,r=t||1,i=e("#cp-table-container").html(n.loadingGif),s=adminpage==="concertpress_page_archives"?"yes":"no";var o={action:"redraw-tables",page:n.eventProgVenue,pageNo:r,numResults:n.numResultsPerPage,archives:s};var u=e.post(ajaxurl,o,function(t){i.hide().html(t).fadeIn(300);e("select#num-events").val(n.numResultsPerPage)});n.pageNo=r},saveOptions:function(t){var n=this,r={action:"save-options",numResults:t},i=e.post(ajaxurl,r,function(e){n.numResultsPerPage=+e})},datePicker:function(){this.event.$date.add(this.event.$endDate).datepicker({showOn:"both",buttonImage:phpvars.plugin_url+"img/calendar_icon.png",buttonImageOnly:false,dateFormat:"yy-mm-dd",firstDay:1,numberOfMonths:2})},multiDateChange:function(){var t=this,n=e("p.endDate");if(!t.event.$multiDate.is(":checked")){n.hide();t.event.$hour.add(t.event.$min).attr("disabled",false)}t.event.$multiDate.change(function(){n.stop(true,true).fadeToggle(300);if(t.event.$multiDate.is(":checked")){t.event.$hour.add(t.event.$min).attr("disabled",true)}else{t.event.$hour.add(t.event.$min).attr("disabled",false)}})},venueProgSelectChange:function(e){if(e==="venue"){if(t.event.$venueHide.is(":visible")){t.event.$venueHide.fadeOut(200);t.event.$showVenue.fadeIn(300)}}else if(e==="prog"){if(t.event.$progHide.is(":visible")){t.event.$progHide.fadeOut(300);t.event.$showProg.fadeIn(400)}}},addNewEventProgOrVenue:function(t){var n=this,r="Add ";n.editFlag="no";n.eventProgVenue=t;n.removeMessageDivs();switch(t){case"event":r+="event";tinyMCE.init({onitit:function(){tinyMCE.activeEditor.setContent("")}});e("form.cp-form select").val(0);e("input#multi-date").attr("checked",false);break;case"prog":r+="programme";tinyMCE.init({onitit:function(){tinyMCE.activeEditor.setContent("")}});break;case"venue":r+="venue";e("#map-canvas").hide();break}n.$submit.val(r);n.showAddEditDiv();e("input.cp-clear").val("");if(t!=="event"){e("input.cp-clear:first").focus()}},history:function(e){var n=!t.popped&&location.href==t.initialURL,r;t.popped=true;if(n===true){}else{if(location.hash===""){r=1}else{r=location.hash.split("=");r=+r[1]}if(r!==t.pageNo){t.reloadAfterAjax(r)}}e.preventDefault()},createMap:function(e){var t=e.url!==""?'<p><a href="'+e.url+'">'+e.url+"</a></p>":"",n=new google.maps.LatLng(e.lat,e.lng);var r={zoom:14,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP};var i=new google.maps.Map(document.getElementById("map-canvas"),r);var s='<div id="content">'+'<h2 id="firstHeading" class="firstHeading">'+e.name+"</h2>"+'<div id="bodyContent">'+"<p>"+e.address+"</p>"+t+"</div>"+"</div>";var o=new google.maps.InfoWindow({content:s});var u=new google.maps.Marker({position:n,map:i,title:name});google.maps.event.addListener(u,"click",function(){o.open(i,u)})}};e(window).bind("popstate",t.history);t.datePicker();t.multiDateChange();e("select.cp-select").change(function(){var n=e(this).hasClass("select-venue")?"venue":"prog";t.venueProgSelectChange(n)});e("div.cp-inside").on("click","p#add-p",function(n){var r=e(this).attr("data-type");t.addNewEventProgOrVenue(r);t.button=e(this).clone();e(this).remove();n.preventDefault()});e("input#cancel").click(function(e){t.$header.after(t.button);t.hideAddEditDiv();e.preventDefault()});t.editEvent=function(t){var n=this,r={edit_id:+t.attr("data-event-id"),prog_id:+t.attr("data-prog-id"),venue_id:+t.attr("data-venue-id"),date:t.attr("data-date"),hour:t.attr("data-hour"),min:t.attr("data-min"),multidate:t.attr("data-multidate"),enddate:t.attr("data-enddate")};e("input.cp-clear").val("");n.event.$hour.add(n.event.$min).val(0);n.event.$date.val(r.date);n.event.$endDate.val(r.enddate);if(r.hour!="00"){n.event.$hour.val(r.hour);n.event.$min.val(r.min)}if(r.multidate=="1"){if(!n.event.$multiDate.is("checked")){n.event.$multiDate.attr("checked",true).trigger("change")}}else{if(n.event.$multiDate.is("checked")){n.event.$multiDate.attr("checked",false).trigger("change")}}n.event.$venueSelect.val(r.venue_id);n.event.$progSelect.val(r.prog_id);n.$submit.val("Save changes");n.editFlag="yes";n.removeMessageDivs();n.editID=r.edit_id;n.showAddEditDiv()};e("div#cp-table-container").on("click","a.edit-event",function(n){t.editEvent(e(this));n.preventDefault()});t.copyEvent=function(e){var t=this,n={prog_id:+e.attr("data-prog-id"),venue_id:+e.attr("data-venue-id")};t.event.$venueSelect.val(n.venue_id);t.event.$progSelect.val(n.prog_id);t.$submit.val("Add event");t.editFlag="no";t.removeMessageDivs();t.showAddEditDiv()};e("div#cp-table-container").on("click","a.copy-event",function(n){t.copyEvent(e(this));n.preventDefault()});t.editVenue=function(t){var n=this.stripslashes(t.attr("data-name")),r=t.attr("data-url"),i=t.attr("data-address"),s=+t.attr("data-lat"),o=+t.attr("data-lng");this.editFlag="yes";this.eventProgVenue="venue";this.editID=+t.attr("data-edit-id");this.removeMessageDivs();this.venue.$venueName.val(n);this.venue.$venueURL.val(r);this.venue.$venueAddress.val(i);if(e("#map-canvas").length){e("#map-canvas").remove()}if(s!==0&&o!==0){var u=e('<div id="map-canvas" />');e("#venue-section").append(u);this.createMap({name:n,address:i,url:r,lat:s,lng:o})}this.$submit.val("Save changes");this.showAddEditDiv()};e("div#cp-table-container").on("click","a.edit-venue",function(n){t.editVenue(e(this));n.preventDefault()});t.checkAssociationsProgVenue=function(){var n=this,r={multiple:false},i=e.extend(r,n.deleteVals),s={action:"check-prog-venue-associations",IDs:i.id,eventProgVenue:n.eventProgVenue,_ajax_nonce:phpvars.nonce};n.eventsToDelete="";n.$ajaxLoader.show();var o=e.post(ajaxurl,s,function(e){n.$ajaxLoader.hide();n.eventsToDelete=e;var r="",o;switch(n.eventProgVenue){case"venue":case"venues":o="venue";break;case"prog":case"progs":o="programme";break;case"event":case"events":o="event";break}if(i.multiple===false){if(e.length===0){r+="<p>Are you sure you want to delete the "+o+" <strong>"+t.deleteVals.name+"</strong>?</p>"}else{r+="<p>Are you sure you want to delete the "+o+" <strong>"+t.deleteVals.name+"</strong>?</p>";r+="<p>The "+o+" is associated with one or more events that will also be deleted!</p>"}}else{if(s.IDs.length===1){r+="<p>Are you sure you want to delete this "+o+"?</p>";if(e.length>0){r+="<p>This "+o+" is associated with one or more events that will also be deleted!</p>"}}else{r+="<p>Are you sure you want to delete these "+o+"s?</p>";if(e.length>0){r+="<p>At least one of the "+o+"s is associated with one more events that will also be deleted!</p>"}}}r+="<p><strong>This action cannot be undone!</strong></p>";t.$dialog.html(r).dialog("open")})};t.deleteEventProgOrVenue=function(){var t=this,n=e.extend({multiple:false},t.deleteVals),r={action:"delete-event-prog-venue-ajax",delIDs:n.id,eventProgVenue:t.eventProgVenue,_ajax_nonce:phpvars.nonce};var i=e.post(ajaxurl,r,function(i){var s=0,o=i.length,u=false;for(;s<o;s++){if(i[s]==="error"){u=true;break}}var a,f={type:"updated"};switch(t.eventProgVenue){case"prog":case"progs":a="programme";break;case"event":case"events":a="event";break;case"venue":case"venues":a="venue";break}if(u===false){if(n.multiple===false){f.message="<p>The "+a+" <strong>"+n.name+"</strong> has been deleted.</p>"}else{if(r.delIDs.length>1){f.message="<p>The "+a+"s have been deleted.</p>"}else{f.message="<p>The "+a+" has been deleted.</p>"}}if(t.eventsToDelete.length>0){var l=0,c=t.eventsToDelete.length,h=[];for(;l<c;l++){var p=t.eventsToDelete[l],d=0,v=p.length;for(;d<v;d++){h.push(p[d]["event_id"])}}r.delIDs=h;r.eventProgVenue="event";var m=e.post(ajaxurl,r,function(e){var t=0,n=e.length;for(;t<n;t++){if(e[t]==="error"){u=true;break}}if(u===true){f.message="<p>Sorry, something went wrong. The "+a+"(s) may not have been deleted. Please try again.</p>";f.type="error"}})}}else{f.message="<p>Sorry, something went wrong. The "+a+"(s) may not have been deleted. Please try again.</p>";f.type="error"}t.messageFeedback(f);t.hideAddEditDiv({removeMessages:false});t.$ajaxLoader.hide();t.reloadAfterAjax(t.pageNo);e("input.cp-checkbox-action").attr("checked",false);e("select#action").val(0)})};e("div#cp-table-container").on("click","a.cp-delete",function(n){var r=e(this);t.deleteVals={id:[+r.attr("data-id")],name:t.stripslashes(r.attr("data-name"))};if(adminpage==="concertpress_page_events"||adminpage==="concertpress_page_archives"){html="<p>Are you sure you want to delete this event?</p>";html+="<p><strong>This cannot be undone!</strong></p>";t.$dialog.html(html).dialog("open")}else{t.eventProgVenue=e(this).attr("data-type");t.checkAssociationsProgVenue()}n.preventDefault()});e("div#cp-table-container").on("change","select#action",function(n){if(e(this).val()=="delete"&&e("input.cp-checkbox:checked").length){var r=[];e.each(e("input.cp-checkbox:checked"),function(){r.push(+e(this).val())});t.deleteVals={multiple:true,id:r};if(adminpage==="concertpress_page_events"||adminpage==="concertpress_page_archives"){html="<p>Are you sure you want to delete ";html+=r.length>1?"these events?":"this event?";html+="</p>";html+="<p><strong>This cannot be undone!</strong></p>";t.$dialog.html(html).dialog("open")}else{t.checkAssociationsProgVenue()}}});t.submitVenue=function(t){var n=this,r={message:"",type:"error"},i=[];n.addedFlag=false;n.$ajaxLoader.show();if(n.venue.$venueName.val()==""){i.push("<p>You must provide a title for the new venue.</p>");r.callback=function(){n.venue.$venueName.focus()}}if(!n.venue.$venueURL.val()==""&&!n.regExURL.test(n.venue.$venueURL.val())){i.push("<p>The venue URL (the website) seems invalid.</p>");r.callback=function(){n.venue.$venueURL.focus()}}if(i.length){var s=0,o=i.length;for(;s<o;s++){r.message+=i[s]}n.messageFeedback(r);n.$ajaxLoader.hide()}else{var u={action:"new-venue-ajax",editflag:n.editFlag,edit_id:+n.editID,venue:{name:n.venue.$venueName.val(),URL:n.venue.$venueURL.val(),address:n.venue.$venueAddress.val()},_ajax_nonce:phpvars.nonce};var a=e.post(ajaxurl,u,function(t){var r={message:"",type:"error"};switch(t.result){case"exists":r.message="<p>The venue <strong>"+u.venue.name+"</strong> already exists.</p>";r.callback=function(){n.venue.$venueName.val("").focus()};break;case"error":r.message="<p>Sorry, there was an error submitting the venue to the database. Please try again.</p>";break;case 0:r.message="<p>Nothing was changed!</p>";e("input#cancel").trigger("click");break;case 1:r.message="<p>The venue <strong>"+u.venue.name+"</strong> was successfully "+t.addUpdate+".</p>";r.type="updated";e("input.cp-clear").val("");n.addedFlag=true;if(n.editFlag==="yes"){n.hideAddEditDiv({removeMessages:false});if(e("#map-canvas").length){e("#map-canvas").remove()}}n.reloadAfterAjax(n.pageNo);n.editFlag="no";n.editID=0;n.$submit.val("Add venue");break}n.$ajaxLoader.hide();n.messageFeedback(r)})}};e("input#venue-submit").click(function(n){t.submitVenue(e(this));n.preventDefault()});t.editProgramme=function(t){this.removeMessageDivs();this.editFlag="yes";this.eventProgVenue="prog";this.editID=+t.attr("data-edit-id");var n=this.stripslashes(t.attr("data-name")),r=e("td.content-full-"+this.editID).html();this.prog.$progTitle.val(n);tinyMCE.init({onitit:function(){tinyMCE.activeEditor.setContent(r)}});this.$submit.val("Save changes");this.showAddEditDiv()};e("div#cp-table-container").on("click","a.edit-programme",function(n){t.editProgramme(e(this));n.preventDefault()});t.submitEvent=function(n){var r=this,i=[];var s={action:"new-event-ajax",editflag:t.editFlag,edit_id:+t.editID,progSelectFlag:0,venueSelectFlag:0,event:{date:t.event.$date.val(),multidateflag:0},prog:{},venue:{},_ajax_nonce:phpvars.nonce};r.removeMessageDivs();r.$ajaxLoader.show();if(r.event.$date.val()==""){i.push("You must provide a date.")}else if(!r.regExDate.test(r.event.$date.val())){i.push("The date must be in the format YYYY-MM-DD. For example: 2012-25-12 ")}if(r.event.$multiDate.is(":checked")){s.event.multidateflag=1;if(r.event.$date.val()!=""&&r.event.$endDate.val()!=""){var o=r.event.$date.val().replace(/-/g,"/"),u=r.event.$endDate.val().replace(/-/g,"/");o=new Date(o);u=new Date(u);if(u<=o){i.push("The end date for the event shoule be later the start date!")}}if(r.event.$endDate.val()==""){i.push("You must provide an end date for multi-day events.")}else if(!r.regExDate.test(r.event.$endDate.val())){i.push("The end date is not properly formatted. It must be in the format YYYY-MM-DD. For example: 2012-25-12 ")}}if(r.event.$venueSelect.length){if(r.venue.$venueName.val()==""&&r.event.$venueSelect.val()==""){i.push("Please add or select a venue.")}}else{if(r.venue.$venueName.val()==""){i.push("Please add a venue.")}}if(!r.venue.$venueURL.val()==""&&!r.regExURL.test(t.venue.$venueURL.val())){i.push("There seems to be a problem with the venue URL")}if(r.event.$progSelect.length){if(r.prog.$progTitle.val()==""&&r.event.$progSelect.val()==""){i.push("Please add or select a programme.")}}else{if(r.prog.$progTitle.val()==""){i.push("Please add a programme.")}}var a={message:"<p>There were some errors with the event you're adding</p>",type:"error"};if(i.length){var f=0,l=i.length;a.message+='<ul id="cp-errors-list">';for(;f<l;f++){a.message+="<li>"+i[f]+"</li>"}a.message+="</ul>";r.messageFeedback(a);r.$ajaxLoader.hide()}else{if(s.event.multidateflag===1){s.event.enddate=r.event.$endDate.val()}else{s.event.hour=+r.event.$hour.val();s.event.min=+r.event.$min.val()}if(r.event.$venueSelect.length&&r.event.$venueSelect.val()!=null){s.venueSelectFlag=1;s.venue_select_id=+r.event.$venueSelect.val();s.venue.name=r.event.$venueSelect.find("option:selected").text()}else{s.venue.name=r.venue.$venueName.val();s.venue.URL=r.venue.$venueURL.val();s.venue.address=r.venue.$venueAddress.val()}if(r.event.$progSelect.length&&r.event.$progSelect.val()!=null){s.progSelectFlag=1;s.prog_select_id=+r.event.$progSelect.val();s.prog.title=r.event.$progSelect.find("option:selected").text()}else{s.prog.title=r.prog.$progTitle.val();var c;if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){c=e("#programme-details").val()}else{c=tinyMCE.activeEditor.getContent()}s.prog.details=c}var h=e.post(ajaxurl,s,function(n){var i={type:"error",message:""};if(n.prog.result==="error"||n.venue.result==="error"||n.event.result==="error"){i.message+="<p>Sorry! There was an error adding the event to the database. Snap. Please try again.</p>."}else{if(n.prog.result==="exists"&&n.venue.result==="exists"){i.message+="<p>A programme called <strong>"+s.prog.title+"</strong> and a venue called <strong>"+s.venue.name+"</strong> already exist!</p>"+"<p>Please select an existing programme or venue from the drop-down menu or add a new programme or venue.</p>";i.callback=function(){t.prog.$progTitle.val("");t.venue.$venueName.val("").focus()}}else if(n.prog.result==="exists"){i.message+="<p>A programme called <strong>"+s.prog.title+"</strong> already exists.</p>"+"<p>Please select an existing programme from the drop-down menu or add a new programme.</p>";i.callback=function(){t.prog.$progTitle.val("").focus()}}else if(n.venue.result==="exists"){i.message+="<p>The venue <strong>"+s.venue.name+"</strong> already exists.</p>"+"<p>Please select an existing venue from the drop-down menu or add a new venue.</p>";i.callback=function(){r.venue.$venueName.val("").focus()}}if(n.event.result===1){i.message+="<p>The event: <strong>"+s.prog.title+"</strong> at <strong>"+s.venue.name+"</strong> on <strong>"+n.date+"</strong> was successfully "+n.addUpdate+".</p>";i.type="updated";e("input.cp-clear").val("");if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){e("#programme-details").val("")}else{tinyMCE.activeEditor.setContent("")}r.event.$multiDate.attr("checked",false).trigger("change");r.event.$hour.add(r.event.$min).attr("disabled",false).val(0);r.event.$venueSelect.add(r.event.$progSelect).val(0);r.event.$venueHide.add(r.event.$progHide).hide();r.event.$showVenue.add(r.event.$showProg).show();e("p.endDate").hide();if(r.editFlag==="yes"){r.hideAddEditDiv({removeMessages:false})}r.editFlag="no";r.editID=0;r.$submit.val("Add event");r.reloadAfterAjax(r.pageNo);if(s.progSelectFlag===0){var o='<option value="'+n.prog.id+'">'+s.prog.title+"</option>";if(!r.event.$progSelect.length){var u=e("<select />",{id:"select-prog",name:"select-prog","class":"cp-select long select-prog"});u.append('<option value=""> -- select a programme -- </option>').append(o);e("p#select-list-prog-p").prepend(u);e("select#select-prog").after(" &nbsp;<strong>or</strong>&nbsp; ")}else{r.event.$progSelect.append(o)}t.event.$progSelect=e("select#select-prog")}if(s.venueSelectFlag===0){var a='<option value="'+n.venue.id+'">'+s.venue.name+"</option>";if(!r.event.$venueSelect.length){var f=e("<select />",{id:"select-venue",name:"select-venue","class":"cp-venue long select-prog"});f.append('<option value=""> -- select a venue -- </option>').append(a);e("p#select-list-venue-p").prepend(f);e("select#select-venue").after(" &nbsp;<strong>or</strong>&nbsp; ")}else{r.event.$venueSelect.append(a)}t.event.$venueSelect=e("select#select-venue")}}else if(n.event.result===0){i.message="<p>Nothing was changed</p>";e("input#cancel").trigger("click")}r.messageFeedback(i)}})}r.$ajaxLoader.hide()};e("input#event-submit").click(function(n){t.submitEvent(e(this));n.preventDefault()});t.event.$showProg.click(function(r){t.event.$progHide.fadeIn(500).find("input:first").focus();t.event.$progSelect.val(0);e(this).hide();r.preventDefault()});t.event.$showVenue.click(function(r){t.event.$venueHide.fadeIn(500).find("input:first").focus();t.event.$venueSelect.val(0);e(this).hide();r.preventDefault()});t.submitProgramme=function(t){var n=this,r,i={type:"error"};n.removeMessageDivs();if(n.prog.$progTitle.val()==""){i.message="<p>You must provide a title for the new programme.</p>";i.callback=function(){n.prog.$progTitle.focus()};n.messageFeedback(i)}else{n.$ajaxLoader.show();var s;if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){s=e("#programme-details").val()}else{s=tinyMCE.activeEditor.getContent()}var o={action:"new-programme-ajax",editflag:n.editFlag,edit_id:+n.editID,prog:{title:n.prog.$progTitle.val(),details:s},_ajax_nonce:phpvars.nonce};var u=e.post(ajaxurl,o,function(t){switch(t.result){case"exists":i.message="<p>The programme title <strong>"+o.prog.title+"</strong> already exists. Please choose a different title.</p>";i.callback=function(){n.prog.$progTitle.val("").focus()};break;case"error":i.message="<p>Sorry, there was an error submitting the programme to the database. Please try again.</p>";break;case 0:i.message="<p>Nothing was changed!</p>";e("input#cancel").trigger("click");break;case 1:i.message="<p>The programme <strong>"+o.prog.title+"</strong> was successfully "+t.addUpdate+".</p>";i.type="updated";n.reloadAfterAjax(n.pageNo);n.prog.$progTitle.val("");if(tinyMCE.activeEditor==null||tinyMCE.activeEditor.isHidden()!=false){e("#programme-details").val("")}else{tinyMCE.activeEditor.setContent("")}n.$submit.val("Add programme");if(n.editFlag=="yes"){n.hideAddEditDiv({removeMessages:false})}n.editFlag="no";n.editID=0;break}n.removeMessageDivs();n.$ajaxLoader.hide();n.messageFeedback(i)})}};e("input#prog-submit").click(function(n){t.submitProgramme(e(this));n.preventDefault()});e("#cp-table-container").on("click","a.page-numbers",function(n){if(!e(this).hasClass("current")){var r=+e(this).attr("data-pageno");history.pushState(null,"Page: "+r,this.href);t.eventProgVenue=e("div#cp-table-container").attr("data-page");t.reloadAfterAjax(r)}n.preventDefault()});if(window.location.hash!==""){e("#cp-table-container").html(t.loadingGif)}e(document).keyup(function(t){if(t.keyCode==27){e("#cancel").click()}});e("div#cp-table-container").on("change","input.cp-checkbox-action:checkbox",function(){if(e(this).is(":checked")){e("input.cp-checkbox, input.cp-checkbox-action").attr("checked",true)}else{e("input.cp-checkbox, input.cp-checkbox-action").attr("checked",false)}});e("div#cp-table-container").on("change","select#num-events",function(n){var r=t.numResultsPerPage=+e("select#num-events option:selected").val(),i=window.location.href.replace(/#[\w=]+/,"");t.saveOptions(r);t.reloadAfterAjax();history.pushState(null,"Page: #1",i)});e("select#num-events").val(t.numResultsPerPage);e("span.checkbox_label").click(function(){$checkBox=e('input[name="multiDate"]');if($checkBox.is(":checked")){$checkBox.attr("checked",false).trigger("change")}else{$checkBox.attr("checked",true).trigger("change")}})})